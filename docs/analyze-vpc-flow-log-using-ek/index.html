<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-analyze-vpc-flow-log-using-ek/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Analyze VPC Flow log using EK | Devops4Solutions Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://devops4solutions.github.io/website1/docs/analyze-vpc-flow-log-using-ek/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Analyze VPC Flow log using EK | Devops4Solutions Documentation"><meta data-rh="true" name="description" content="This blog will help you to Analyze VPC Flow logusing Elastic Search"><meta data-rh="true" property="og:description" content="This blog will help you to Analyze VPC Flow logusing Elastic Search"><link data-rh="true" rel="icon" href="/website1/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://devops4solutions.github.io/website1/docs/analyze-vpc-flow-log-using-ek/"><link data-rh="true" rel="alternate" href="https://devops4solutions.github.io/website1/docs/analyze-vpc-flow-log-using-ek/" hreflang="en"><link data-rh="true" rel="alternate" href="https://devops4solutions.github.io/website1/docs/analyze-vpc-flow-log-using-ek/" hreflang="x-default"><link rel="stylesheet" href="/website1/assets/css/styles.c7e5e7cb.css">
<link rel="preload" href="/website1/assets/js/runtime~main.3d298911.js" as="script">
<link rel="preload" href="/website1/assets/js/main.82fb9969.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/website1/"><b class="navbar__title text--truncate">DevOps Documentation</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/website1/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/website1/docs/analyze-vpc-flow-log-using-ek/">Analyze VPC Flow log using EK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/website1/docs/ansible-setup-on-aws/">Ansible Setup on AWS EC2 Instance with windows Nodes</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/website1/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Analyze VPC Flow log using EK</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Analyze VPC Flow log using EK</h1></header><p>This blog will help you to Analyze VPC Flow logusing Elastic Search</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*zsRamahrG00qYn6_Go1i0Q.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="toolstask">Tools/Task:<a class="hash-link" href="#toolstask" title="Direct link to heading">​</a></h2><ol><li>Create Flow Log in VPC</li><li>IAM Role for VPC Flow Log</li><li>Cloudwatch Log Group</li><li>ElasticSearch</li><li>IAM Lambda role</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-flow-log-on-vpc">Create Flow Log on VPC<a class="hash-link" href="#create-flow-log-on-vpc" title="Direct link to heading">​</a></h2><ol><li>Open VPC</li><li>Click on Create Flow Log</li></ol><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*muC16yJKRdZkbA8W0xmshg.png" class="img_ev3q"></p><p>3<!-- -->.<!-- --> For Role — Click on Set up Permissions, it will create a role and then select it</p><p>4<!-- -->.<!-- --> For Destination Log Group — this is the cloud watch log group name</p><p>The name of the CloudWatch Logs log group to which the flow log will be published. A log stream will be created in this log group for each network interface being monitored.</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*7jaTWkaYrsVpuOdsd9sa9Q.png" class="img_ev3q"></p><p>Flow Log is created successfully.</p><p>You can check the flow logs being generated</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*u7t8FrtmNCzluZStwwgBKg.png" class="img_ev3q"></p><p>ElasticSearch Service</p><ol><li>Create domain</li></ol><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*AHCyu_Z3v0yiafLui--zuA.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*XuYx8v-o8R3xkEfUu0rWXg.png" class="img_ev3q"></p><p>All default setting then</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*jWZIFaBx56y6HDIFKuPXxw.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*Q1wcWd0kM2I_xo3dPT5QMQ.png" class="img_ev3q"></p><p>Click Confirm</p><p>It will take around 10 minutes to create a elasticsearch service</p><p>Now go to cloudwatch</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*j7vX4xmVLUIAxMTq94mN5w.png" class="img_ev3q"></p><p>Click on Actions -&gt; Stream to Amazon ElasticSearchService.</p><p>Select this Account and your ES cluster</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*YUT0L9NLqeGsBZ6kZt9U4w.png" class="img_ev3q"></p><p>CloudWatch Logs uses Lambda to deliver log data to Amazon ES. You must specify an IAM role that grants Lambda permission to make calls to Amazon ES. You can choose an existing role or create an IAM role that automatically has the required permissions. To deliver log data to another account, you must specify the Elasticsearch Domain ARN and Elasticsearch Endpoint of other account and ensure permissions are granted to be able to publish to that ARN.</p><p>Select — Click on Create new role</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*pH-3Y1VtQkF2L3YmiFzrOw.png" class="img_ev3q"></p><p>{ “Version”: “2012–10–17”, “Statement”: <!-- -->[<!-- --> { “Effect”: “Allow”, “Action”: <!-- -->[<!-- --> “logs:CreateLogGroup”, “logs:CreateLogStream”, “logs:PutLogEvents” <!-- -->]<!-- -->, “Resource”: <!-- -->[<!-- --> “arn:aws:logs:<!-- -->*<!-- -->:<!-- -->*<!-- -->:<!-- -->*<!-- -->” <!-- -->]<!-- --> }, { “Effect”: “Allow”, “Action”: “es:ESHttpPost”, “Resource”: “arn:aws:es:<!-- -->*<!-- -->:<!-- -->*<!-- -->:<!-- -->*<!-- -->” } <!-- -->]<!-- --> }</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*oixyMeovZ8VfRyz79Lj1Hg.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*o7l_x2crLODV7KAwTLGWAg.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*eH13p5kClhqptdaYv8eZXg.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*cOcpMjB1Rr-FtY8a47V5Gg.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*HBetv-h-QMdgpm8eRJ4snw.png" class="img_ev3q"></p><p>You will see all the fields</p><p>Click on Discover, you will see the graph based on timestamp</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*cvdulZU9t8xuwo-sjxCAoA.png" class="img_ev3q"></p><p>Create a visualization as per your requirement</p><p><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*4BVjqAJo1-ocjdLzgcjoug.png" class="img_ev3q"></p><p>Create a Dashboard, add the visualization which you have created above to show it on your dashboard.</p><p>To do it using script, please follow the below link, it will work as it is.</p><p><a href="https://www.terraform.io/docs/providers/aws/r/flow_log.html" target="_blank" rel="noopener noreferrer" title="https://www.terraform.io/docs/providers/aws/r/flow_log.html"><strong>AWS: aws<!-- -->_<!-- -->flow<!-- -->_<!-- -->log - Terraform by HashiCorp</strong> _Provides a VPC/Subnet/ENI Flow Log_www.terraform.io</a></p><p>References</p><p><a href="https://www.youtube.com/watch?v=DMpfC3juTGQ" target="_blank" rel="noopener noreferrer">CLick Here</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://devops4solutions.github.io/docs/edit/main/docs/analyze-vpc-flow-log-using-ek/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/website1/docs/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/website1/docs/ansible-setup-on-aws/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ansible Setup on AWS EC2 Instance with windows Nodes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#toolstask" class="table-of-contents__link toc-highlight">Tools/Task:</a></li><li><a href="#create-flow-log-on-vpc" class="table-of-contents__link toc-highlight">Create Flow Log on VPC</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/website1/assets/js/runtime~main.3d298911.js"></script>
<script src="/website1/assets/js/main.82fb9969.js"></script>
</body>
</html>